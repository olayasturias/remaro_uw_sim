<launch>
    <arg name="rov_model" default="rexrov2"/>
    <arg name="gui" default="false"/>
 	<arg name="output" default="screen"/>
	<arg name="publish_clock" default="false"/>
	<arg name="is_vulkan" default="true"/>
	<arg name="is_enu" default="false"/>
	<arg name="use_ned_frame" default="false" doc="If true, uses the NED (North-East-Down) frame conversion. If false, ENU (East-North-Up) will be used per default."/>
	<arg name="host" default="localhost" />
	<arg name="node_start_delay" default="10.0" />  

	<!-- Controller parameters -->
	<arg name="teleop_on" default="false" doc="If true, the teleop node will be started"/>
    <arg name="joy_id" default="0" doc="Joystick ID"/>


    <!-- Load gazebo backend with physics motor without visuals -->
    <include file="$(find uwsim)/launch/gazebo_backend.launch" >
		<arg name="gui" value="$(arg gui)"/>
		<arg name="rov_model" value="$(arg rov_model)"/>
    </include>

	<!-- Load gazebo-airsim bridge for physics engine -->
	<node type="GazeboDrone" name="GazeboDrone" pkg="gazebodrone" launch-prefix="bash -c 'sleep $(arg node_start_delay); $0 $@' "/>

    <!-- Load airsim-ros bridge -->
	<node name="airsim_node" pkg="airsim_ros_pkgs" type="airsim_node" output="$(arg output)" respawn="true"> 
		<param name="is_vulkan" type="bool" value="false" /> 
		<!-- ROS timer rates. Note that timer callback will be processed at maximum possible rate, upperbounded by the following ROS params -->
		<param name="update_airsim_img_response_every_n_sec" type="double" value="0.05" /> 
		<param name="update_airsim_control_every_n_sec" type="double" value="0.01" />
		<param name="update_lidar_every_n_sec" type="double" value="0.01" />
		<param name="publish_clock" type="bool" value="$(arg publish_clock)" />
		<param name="host_ip" type="string" value="$(arg host)" />
		<!-- <param name="world_frame_id" type="string" value="$(arg rov_model)/base_footprint"/> -->
		<param name="is_ENU" type="bool" value="$(arg is_enu)"/>
		<param name="invert_Z" type="bool" value="true"/>
		<param name="world_frame_id" type="string" value="world_ned"/>
		<!-- <param name="world_frame_id" type="string" value="world"/> -->

	</node>

	<!-- Run ROV controllers -->
	<include file="$(find rexrov2_control)/launch/start_pid_controller.launch">
        <arg name="teleop_on" value="$(arg teleop_on)"/>
        <arg name="joy_id" value="$(arg joy_id)"/>
        <arg name="use_ned_frame" value="$(arg use_ned_frame)"/>
		<arg name="gui_on" value="false"/>
    </include>

	<!-- align airsim ROS API and UUV -->
    <node pkg="tf2_ros" type="static_transform_publisher" name="world_ned_frame_publisher"
    args="0 0 0 0 0 3.141592653589793 world world_ned" />

    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find uwsim)/rviz/$(arg rov_model).rviz" />

    <!-- Static transforms for airsim node, aligning airsim tf with gazebo tf -->
    <node pkg="tf" type="static_transform_publisher" name="ned_to_enu_pub" args="0 0 0 1.57 0 3.14 world_ned world_enu 100"/> 
</launch>